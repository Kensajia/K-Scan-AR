<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>K-Scan AR - Acceso</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===============================================================
   VARIABLES BASE
================================================================ */
:root {
    --accent: #007bff;
    --danger: #dc3545;
}

/* ===============================================================
   ESTILO BASE
================================================================ */
body {
    font-family: sans-serif;
    display: flex; justify-content: center; align-items: center;
    height: 100vh; margin: 0; flex-direction: column;
    transition: 0.3s;
}

.container {
    padding: 40px; border-radius: 10px; text-align: center;
    width: 90%; max-width: 400px; transition: 0.3s;
}

/* ===============================================================
   TEMA CLARO
================================================================ */
.light-theme { background: #f4f4f4; color: #333; }
.light-theme .container { background: white; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
.light-theme button { background: var(--accent); color: white; }

/* ===============================================================
   TEMA OSCURO
================================================================ */
.dark-theme { background: #1a1a1a; color: #f4f4f4; }
.dark-theme .container { background: #2c2c2c; box-shadow: 0 4px 8px rgba(0,0,0,0.5); }
.dark-theme button { color: white; border: 1px solid #666; background: #3c3c3c; }
.dark-theme #access-button, 
.dark-theme .access-btn { background: var(--accent); border: none; }
.dark-theme .delete-btn { background: var(--danger); border: none; }
.dark-theme input { background: #3c3c3c; color: white; border: 1px solid #4a4a4a; }
.dark-theme .logo { background: white; padding: 12px; border-radius: 15px; filter: drop-shadow(0 0 5px white); }


  
    
/* ===============================================================
   üîµ PALLETAS PERSONALIZADAS (DESACTIVADAS)
   PARA ACTIVAR UNA, SOLO BORRA EL "/*" Y "*/"
================================================================ */

/* ---------- PALETA 1 ---------- *
.palette1-theme { background: #f2ebe9; color: #4a3b36; }
.palette1-theme .container { background: #fff; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
.palette1-theme button { background: #9c6644; color: white; }
 */

/* ---------- PALETA 2 ---------- *
.palette2-theme { background: #001219; color: #e9d8a6; }
.palette2-theme .container { background: #0a9396; }
.palette2-theme button { background: #94d2bd; }
/* */

/* ---------- PALETA 3 ---------- *
.palette3-theme { background: #002b36; color: #eee8d5; }
.palette3-theme .container { background: #073642; }
.palette3-theme button { background: #b58900; color: #002b36; }
/* */

/* ---------- PALETA 4 ---------- *
.palette4-theme { background: #22223b; color: #f2e9e4; }
.palette4-theme .container { background: #4a4e69; }
.palette4-theme button { background: #9a8c98; }
/* */

/* ---------- PALETA 5 ---------- *
.palette5-theme { background: #ffe6e6; color: #663333; }
.palette5-theme .container { background: white; }
.palette5-theme button { background: #ff9999; }
/* */

/* ===============================================================
   ELEMENTOS COMUNES
================================================================ */
label { display: block; text-align: left; margin-top: 10px; font-weight: bold; }
input { padding: 10px; margin: 5px 0 15px; border-radius: 5px; width: calc(100% - 20px); font-size: 16px; border: 1px solid #ccc; }
button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 5px; }
#error-message { color: red; margin-top: 10px; display: none; }
.logo { margin-bottom: 20px; max-width: 150px; }

/* ===============================================================
   SELECTOR DE TEMA
================================================================ */
.theme-selector { position: fixed; bottom: 15px; right: 15px; text-align: center; }
.theme-selector select { display: none; }
.theme-circles { display: flex; gap: 12px; margin-top: 8px; }
.circle { width: 22px; height: 22px; border-radius: 50%; cursor: pointer; transition: 0.2s; border: 1px solid #aaa; }
.circle:hover, .circle.active { transform: scale(1.3); box-shadow: 0 0 8px white; }

/* C√≠rculos visibles */
.circle[data-value="auto"] { background: linear-gradient(135deg, #000 50%, #fff 50%); }
.circle[data-value="light"] { background: #fff; }
.circle[data-value="dark"] { background: #000; }

/* PARA ACTIVAR PALETAS, DESCOMENTA ESTOS: 
.circle[data-value="palette1"] { background: #9c6644; }
.circle[data-value="palette2"] { background: #0a9396; }
.circle[data-value="palette3"] { background: #b58900; }
.circle[data-value="palette4"] { background: #4a4e69; }
.circle[data-value="palette5"] { background: #ff9999; }
/**/

/* ===============================================================
   USUARIOS GUARDADOS ‚Äî ESTILO ORIGINAL RESTAURADO
================================================================ */
.project-selection-item {
    border: 1px solid #ccc;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 5px;
    text-align: left;
    /*background: white;
    color: black;*/
}

.selection-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
}


/* ===============================================================
   TOOLTIP MODERNO EN LOS C√çRCULOS DE TEMA
================================================================ */

.circle::after {
    content: attr(data-title);
    position: absolute;
    top: -32px;
    left: 50%;
    transform: translateX(-50%);
    padding: 4px 9px;
    font-size: 11px;
    background: rgba(0, 0, 0, 0.75);
    color: white;
    border-radius: 6px;
    opacity: 0;
    pointer-events: none;
    white-space: nowrap;
    transition: opacity 0.25s ease;
}

.circle.show-tooltip::after {
    opacity: 1;
}

</style>

<meta property="og:title" content="K-Scan AR">
<meta property="og:description" content="K-Scan AR: Realidad Aumentada web para sublimados de Kensajia. Introduce tu c√≥digo y visualiza al instante el contenido personalizado de tu producto.">
<meta property="og:image" content="https://raw.githubusercontent.com/Kensajia/K-Scan-AR/refs/heads/main/assets/img/META-LOGO.png">
<meta property="og:url" content="https://kensajia.github.io/K-Scan-AR/">
<meta property="og:type" content="website">
    
</head>
<body>

<div class="container">
    <img src="https://cdn.store.link/uploads/store10333/store-logo.svg" alt="Logo" class="logo">

    <div id="loading-view">Cargando datos...</div>

    <div id="input-view" style="display:none;">
        <h2>Registrar Nuevo Acceso</h2>

        <label>Tu Nombre (Opcional):</label>
        <input type="text" id="user-name" placeholder="IDENTIFICADOR">

        <label>C√≥digo de Usuario:</label>
        <input type="text" id="user-code" placeholder="C√ìDIGO √öNICO">

        <button onclick="handleAccess()" id="access-button">Acceder</button>
        <button onclick="toggleViews('selection')" id="back-button" style="display:none; background:#6c757d">Usuarios Guardados</button>

        <p id="error-message"></p>
    </div>

    <div id="selection-view" style="display:none;">
        <h2>Usuarios Guardados</h2>
        <div id="selection-list"></div>
        <button onclick="toggleViews('input')" style="background:#6c757d; margin-top:20px">Nuevo Usuario</button>
    </div>
</div>

<!-- ===============================================================
     SELECTOR DE TEMA
=============================================================== -->
<div class="theme-selector">
    <label>Tema</label>
    <div class="theme-circles">
        <div class="circle" data-value="auto" title="Autom√°tico"></div>
        <div class="circle" data-value="light" title="Claro"></div>
        <div class="circle" data-value="dark" title="Oscuro"></div>

        <!-- DESCOMENTAR PARA ACTIVAR PALETAS--
        <div class="circle" data-value="palette1"></div>
        <div class="circle" data-value="palette2"></div>
        <div class="circle" data-value="palette3"></div>
        <div class="circle" data-value="palette4"></div>
        <div class="circle" data-value="palette5"></div>
        <!---->
    </div>
</div>

<script>

/* ===============================================================
   TOOLTIP DE TEMAS (TEXTO TEMPORAL AL SELECCIONAR)
================================================================ */

document.addEventListener("DOMContentLoaded", () => {

    document.querySelectorAll(".circle").forEach(circle => {

        // Usar title ‚Üí tooltip sin que el navegador moleste
        let t = circle.getAttribute("title") || circle.dataset.value;
        circle.setAttribute("data-title", t);
        circle.removeAttribute("title");

        // Mostrar tooltip cuando se selecciona el tema
        circle.addEventListener("click", () => {

            // eliminar tooltip previo
            document.querySelectorAll(".circle")
                .forEach(c => c.classList.remove("show-tooltip"));

            // activar tooltip en el seleccionado
            circle.classList.add("show-tooltip");

            // eliminar despu√©s de 1 segundo
            setTimeout(() => {
                circle.classList.remove("show-tooltip");
            }, 1000);
        });
    });

});


/* ===============================================================
   =============================================================
================================================================ */
    
let ProyectosAR = {};
const KEY_STORAGE = "arUserCodes";
const KEY_THEME = "arThemePreference";

/* ===============================================================
   CARGA DE PROYECTOS
================================================================ */
async function loadData() {
    try {
        const r = await fetch("./index-vault/IndexSet.json");
        if (!r.ok) throw new Error();
        ProyectosAR = await r.json();
        document.getElementById("loading-view").style.display = "none";
        init();
    } catch (e) {
        document.getElementById("loading-view").innerHTML = "Error al cargar datos.";
    }
}

/* ===============================================================
   APLICAR TEMA
================================================================ */
function applyTheme(theme) {
    const body = document.body;

    const finalTheme = (theme === "auto")
        ? (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light")
        : theme;

    body.className = finalTheme + "-theme";
    localStorage.setItem(KEY_THEME, theme);

    document.querySelectorAll(".circle").forEach(c =>
        c.classList.toggle("active", c.dataset.value === theme)
    );
}

/* ===============================================================
   ACCESO
================================================================ */
function handleAccess() {
    const code = document.getElementById("user-code").value.trim();
    const name = document.getElementById("user-name").value.trim() || code;

    const err = document.getElementById("error-message");

    if (ProyectosAR[code]) {
        saveCode(code, name, ProyectosAR[code].ruta);
        window.location.href = `./module/${ProyectosAR[code].ruta}/?code=${code}`;
    } else {
        err.textContent = "C√≥digo no v√°lido";
        err.style.display = "block";
    }
}

function saveCode(code, name, ruta) {
    let codes = JSON.parse(localStorage.getItem(KEY_STORAGE) || "[]");
    if (!codes.some(c => c.code === code)) {
        codes.push({ code, name, ruta });
        localStorage.setItem(KEY_STORAGE, JSON.stringify(codes));
    }
}

/* ===============================================================
   VISTAS
================================================================ */
function toggleViews(view) {
    document.getElementById("input-view").style.display = (view === "input" ? "block" : "none");
    document.getElementById("selection-view").style.display = (view === "selection" ? "block" : "none");

    if (view === "selection") renderList();
}

/* ===============================================================
   LISTA DE USUARIOS GUARDADOS
================================================================ */
function renderList() {
    const list = document.getElementById("selection-list");
    const codes = JSON.parse(localStorage.getItem(KEY_STORAGE) || "[]");

    list.innerHTML = codes.length ? "" : "No hay usuarios guardados.";

    codes.forEach(c => {
        const item = document.createElement("div");
        item.className = "project-selection-item";

        item.innerHTML = `
            <h3>${c.name} (${c.code})</h3>
            <div class="selection-actions">
                <button class="access-btn" onclick="window.location.href='./module/${c.ruta}/?code=${c.code}'">Entrar</button>
                <button class="delete-btn" onclick="removeCode('${c.code}')">Eliminar</button>
            </div>
        `;
        list.appendChild(item);
    });

    document.getElementById("back-button").style.display = (codes.length ? "inline-block" : "none");
}

function removeCode(code) {
    let codes = JSON.parse(localStorage.getItem(KEY_STORAGE) || "[]");
    localStorage.setItem(KEY_STORAGE, JSON.stringify(codes.filter(c => c.code !== code)));
    renderList();
}

/* ===============================================================
   INICIO
================================================================ */
function init() {
    const codes = JSON.parse(localStorage.getItem(KEY_STORAGE) || "[]");
    codes.length ? toggleViews("selection") : toggleViews("input");
}

/* ===============================================================
   EVENTOS
================================================================ */
document.addEventListener("DOMContentLoaded", () => {
    const saved = localStorage.getItem(KEY_THEME) || "auto";
    applyTheme(saved);
    loadData();

    document.querySelectorAll(".circle").forEach(c => {
        c.onclick = () => applyTheme(c.dataset.value);
    });

    // ENTER para ejecutar "Acceder"
    document.getElementById("user-code").addEventListener("keypress", (e) => {
        if (e.key === "Enter") handleAccess();
    });
});
</script>

</body>
</html>








